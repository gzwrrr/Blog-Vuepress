import{_ as i,Q as l,S as p,U as n,W as e,X as t,a8 as s,a9 as c,H as o}from"./framework-d7e1aa10.js";const u={},d=n("h1",{id:"无法连接远程主机",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#无法连接远程主机","aria-hidden":"true"},"#"),s(" 无法连接远程主机")],-1),r=n("div",{class:"hint-container info"},[n("p",{class:"hint-container-title"},"说明"),n("p",null,"某次 Git 突然无法连接的排查")],-1),b={class:"table-of-contents"},v=c(`<p>某天 <code>git push</code> 时突然发现：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kex_exchange_identification: Connection closed by remote <span class="token function">host</span>
Connection closed by <span class="token number">198.18</span>.1.62 port <span class="token number">22</span>
fatal: Could not <span class="token builtin class-name">read</span> from remote repository.

Please <span class="token function">make</span> sure you have the correct access rights
and the repository exists.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查找后发现，这个错误通常表示 SSH 连接到远程主机时发生问题。可能是连接的远程主机存在网络故障，或者 SSH 服务未正确运行。</p><p>以下是一些可能的解决方案：</p><ol><li>检查远程主机的网络连接是否正常。您可以尝试使用 ping 命令检查是否可以与远程主机通信。</li><li>检查远程主机上的 SSH 服务是否正在运行，并确保其配置正确。您可以尝试通过远程主机的控制台或 Web 界面访问远程主机，然后检查 SSH 服务是否正在运行。如果 SSH 服务未正确配置，请参考相关文档或联系管理员。</li><li>确保您使用的 SSH 私钥是否仍然有效。如果 SSH 私钥过期或被撤销，则可能无法连接到远程主机。您可以检查私钥文件是否存在，并确保其权限正确。</li><li>尝试使用不同的 SSH 客户端或版本连接到远程主机。有时可能是由于 SSH 客户端与远程主机之间的不兼容性导致连接问题。</li></ol><h2 id="第一次尝试" tabindex="-1"><a class="header-anchor" href="#第一次尝试" aria-hidden="true">#</a> 第一次尝试</h2><p>远程主机可以访问，SSH 服务肯定也是正常的，所以检查本地 SSH 私钥是否过期：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">ssh</span> <span class="token parameter variable">-T</span> git@github.com
<span class="token comment"># 输出了如下信息</span>
kex_exchange_identification: Connection closed by remote <span class="token function">host</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建新密钥：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>ssh-keygen <span class="token parameter variable">-t</span> rsa <span class="token parameter variable">-b</span> <span class="token number">4096</span> <span class="token parameter variable">-C</span> <span class="token string">&quot;your_email@example.com&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>用生成的 id_rsa.pub 在 Github 上重新创建私钥</p><p>补充：不要使用 id_rsa，否则会包下面的错误：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Key is invalid. You must supply a key <span class="token keyword">in</span> OpenSSH public key <span class="token function">format</span>  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果想使用命令将私钥转换成 OpenSSH 格式：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>ssh-keygen <span class="token parameter variable">-i</span> <span class="token parameter variable">-f</span> /path/to/public_key <span class="token operator">&gt;</span> /path/to/new_public_key
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果在 Windows 上无法转换，那么可以安装 PuTTYgen 在转换成 OpenSSH 格式</p><h2 id="第二次尝试" tabindex="-1"><a class="header-anchor" href="#第二次尝试" aria-hidden="true">#</a> 第二次尝试</h2><p>如果重新创建还是不行，就 debug 排除：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">ssh</span> <span class="token parameter variable">-v</span> <span class="token operator">&lt;</span>username<span class="token operator">&gt;</span>@<span class="token operator">&lt;</span>password<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>我这里输出了：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>OpenSSH_for_Windows_8.1p1, LibreSSL <span class="token number">3.0</span>.2
debug1: Reading configuration data C:<span class="token punctuation">\\</span><span class="token punctuation">\\</span>Users<span class="token punctuation">\\</span><span class="token punctuation">\\</span>xxx/.ssh/config
debug1: Connecting to wl. <span class="token punctuation">[</span><span class="token number">198.18</span>.1.108<span class="token punctuation">]</span> port <span class="token number">22</span>.
debug1: Connection established.
debug1: identity <span class="token function">file</span> C:<span class="token punctuation">\\</span><span class="token punctuation">\\</span>Users<span class="token punctuation">\\</span><span class="token punctuation">\\</span>xx/.ssh/id_rsa <span class="token builtin class-name">type</span> <span class="token number">0</span>
debug1: identity <span class="token function">file</span> C:<span class="token punctuation">\\</span><span class="token punctuation">\\</span>Users<span class="token punctuation">\\</span><span class="token punctuation">\\</span>xx/.ssh/id_rsa-cert <span class="token builtin class-name">type</span> <span class="token parameter variable">-1</span>
debug1: identity <span class="token function">file</span> C:<span class="token punctuation">\\</span><span class="token punctuation">\\</span>Users<span class="token punctuation">\\</span><span class="token punctuation">\\</span>xx/.ssh/id_dsa <span class="token builtin class-name">type</span> <span class="token parameter variable">-1</span>
debug1: identity <span class="token function">file</span> C:<span class="token punctuation">\\</span><span class="token punctuation">\\</span>Users<span class="token punctuation">\\</span><span class="token punctuation">\\</span>xx/.ssh/id_dsa-cert <span class="token builtin class-name">type</span> <span class="token parameter variable">-1</span>
debug1: identity <span class="token function">file</span> C:<span class="token punctuation">\\</span><span class="token punctuation">\\</span>Users<span class="token punctuation">\\</span><span class="token punctuation">\\</span>xx/.ssh/id_ecdsa <span class="token builtin class-name">type</span> <span class="token parameter variable">-1</span>
debug1: identity <span class="token function">file</span> C:<span class="token punctuation">\\</span><span class="token punctuation">\\</span>Users<span class="token punctuation">\\</span><span class="token punctuation">\\</span>xx/.ssh/id_ecdsa-cert <span class="token builtin class-name">type</span> <span class="token parameter variable">-1</span>
debug1: identity <span class="token function">file</span> C:<span class="token punctuation">\\</span><span class="token punctuation">\\</span>Users<span class="token punctuation">\\</span><span class="token punctuation">\\</span>xx/.ssh/id_ed25519 <span class="token builtin class-name">type</span> <span class="token parameter variable">-1</span>
debug1: identity <span class="token function">file</span> C:<span class="token punctuation">\\</span><span class="token punctuation">\\</span>Users<span class="token punctuation">\\</span><span class="token punctuation">\\</span>xx/.ssh/id_ed25519-cert <span class="token builtin class-name">type</span> <span class="token parameter variable">-1</span>
debug1: identity <span class="token function">file</span> C:<span class="token punctuation">\\</span><span class="token punctuation">\\</span>Users<span class="token punctuation">\\</span><span class="token punctuation">\\</span>xx/.ssh/id_xmss <span class="token builtin class-name">type</span> <span class="token parameter variable">-1</span>
debug1: identity <span class="token function">file</span> C:<span class="token punctuation">\\</span><span class="token punctuation">\\</span>Users<span class="token punctuation">\\</span><span class="token punctuation">\\</span>xx/.ssh/id_xmss-cert <span class="token builtin class-name">type</span> <span class="token parameter variable">-1</span>
debug1: Local version string SSH-2.0-OpenSSH_for_Windows_8.1
kex_exchange_identification: Connection closed by remote <span class="token function">host</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>有的解决方案是进入存放密钥的目录，将 known_hosts 删除就行</p><p>known_hosts 的作用：本地机接受了远程主机，会将此公钥保存在 known_hosts中，以便之后的验证。</p><p>我这里删除后还是不行，检查远程地址是否允许访问：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>ssh-keyscan github.com
<span class="token comment"># 输出了：</span>
github.com: Connection closed by remote <span class="token function">host</span>
github.com: Connection closed by remote <span class="token function">host</span>
github.com: Connection closed by remote <span class="token function">host</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里应该就是本地的 SSH 服务有问题，但是暂时不知道原因</p><h2 id="第三次尝试" tabindex="-1"><a class="header-anchor" href="#第三次尝试" aria-hidden="true">#</a> 第三次尝试</h2><p>改用另一种方式，在密钥的同级目录下的 config（没有就新建，不用文件后缀名） 中输入：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Host github.com
	Hostname ssh.github.com
	Port <span class="token number">443</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改保存后再次测试连接：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>The authenticity of <span class="token function">host</span> <span class="token string">&#39;[ssh.github.com]:443 ([198.18.1.118]:443)&#39;</span> can<span class="token string">&#39;t be established.
ECDSA key fingerprint is SHA256:p2QAMXNIC1TJYWeIOttrVc98/R1BUFWu3/LiyKgUfQM.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added &#39;</span><span class="token punctuation">[</span>ssh.github.com<span class="token punctuation">]</span>:443,<span class="token punctuation">[</span><span class="token number">198.18</span>.1.118<span class="token punctuation">]</span>:443<span class="token string">&#39; (ECDSA) to the list of known hosts.
Hi gzwrrr! You&#39;</span>ve successfully authenticated, but GitHub does not provide shell access.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第一次接受后就会再次生成 known_hosts，下次再执行 <code>ssh -T git@github.com</code> 就会直接连接成功：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Hi gzwrrr<span class="token operator">!</span> You&#39;ve successfully authenticated, but GitHub does not provide shell access.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,33);function m(k,h){const a=o("router-link");return l(),p("div",null,[d,r,n("nav",b,[n("ul",null,[n("li",null,[e(a,{to:"#无法连接远程主机"},{default:t(()=>[s("无法连接远程主机")]),_:1}),n("ul",null,[n("li",null,[e(a,{to:"#第一次尝试"},{default:t(()=>[s("第一次尝试")]),_:1})]),n("li",null,[e(a,{to:"#第二次尝试"},{default:t(()=>[s("第二次尝试")]),_:1})]),n("li",null,[e(a,{to:"#第三次尝试"},{default:t(()=>[s("第三次尝试")]),_:1})])])])])]),v])}const f=i(u,[["render",m],["__file","无法连接.html.vue"]]);export{f as default};
